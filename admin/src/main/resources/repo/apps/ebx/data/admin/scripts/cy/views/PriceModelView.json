{"type":"cy:bean","properties":{"beanType@STRING":"cy:requiremodule","name@STRING":"PriceModelView","dependencies@STRING":["/libs/bndly/data/scripts/cy/EntityCollection","/apps/ebx/data/admin/scripts/cy/views/StaggeredPriceView","/apps/ebx/data/admin/scripts/cy/views/SimplePriceView","/libs/bndly/data/scripts/cy/Collection","/libs/bndly/data/scripts/cy/ui/container/Form","/libs/bndly/data/scripts/cy/ui/input/DropDownButton","/libs/bndly/data/scripts/cy/RestBeans","/libs/bndly/data/scripts/cy/EntityRelationViewComponent"],"script@STRING":"var PriceModelView = EntityRelationViewComponent.extend({\r\n\tconstruct: function(config) {\r\n\t\tif (!config) {\r\n\t\t\tconfig = {};\r\n\t\t}\r\n\r\n\t\tvar newButton = new DropDownButton({\r\n\t\t\tlabel: \"new\",\r\n\t\t\t\t\t\t\titems: [\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tname: \"SimplePrice\",\r\n\t\t\t\t\t\t\t\t\tlabel: \"Simple Price\"\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tname: \"StaggeredPrice\",\r\n\t\t\t\t\t\t\t\t\tlabel: \"Staggered Price\"\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t],\r\n\t\t\t\t\t\t\tlisteners:{\r\n\t\t\t\t\t\t\t\tclicked: {\r\n\t\t\t\t\t\t\t\t\tfn: this.newPriceButtonClicked,\r\n\t\t\t\t\t\t\t\t\tscope: this\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t});\r\n\t\t\t\t\tif(!config.taxModels) {\r\n\t\t\t\t\t\tconfig.taxModels = new EntityCollection({\r\n\t\t\t\t\t\t\tproto: new RestBeans[\"ValueAddedTaxRestBean\"]()\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\tif(!config.currencies) {\r\n\t\t\t\t\t\tconfig.currencies = new EntityCollection({\r\n\t\t\t\t\t\t\tproto: new RestBeans[\"CurrencyRestBean\"]()\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\tconfig.form = new Form();\r\n\t\tconfig.items = [\r\n\t\t\tnewButton,\r\n\t\t\tconfig.form\r\n\t\t];\r\n\t\tthis.callSuper(arguments, config);\r\n\t\t\t\t\tthis.taxModels.load();\r\n\t\t\t\t\tthis.currencies.load();\r\n\t}, \r\n\trenderTo: function(renderTarget) {\r\n\t\t\t\tthis.invokeSuper(arguments);\r\n\t\t\t\tthis.renderPricesOfParent();\r\n\t},\r\n\t\t\tnewPriceButtonClicked: function(button, item){\r\n\t\t\t\tvar type = RestBeans[item.name+\"RestBean\"];\r\n\t\t\t\tif(!type) {\r\n\t\t\t\t\tconsole.log(\"unsupported price type: \"+item.name);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar price = new type();\r\n\t\t\t\t\tthis.priceItems.add(price);\r\n\t\t\t\t\tthis.renderPrice(price);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\trenderPricesOfParent: function() {\r\n\t\t\t\tvar pm = this.parent.getPriceModel();\r\n\t\t\t\tif(!pm) {\r\n\t\t\t\t\tpm = new RestBeans[\"PriceModelRestBean\"]();\r\n\t\t\t\t\tthis.parent.setPriceModel(pm);\r\n\t\t\t\t}\r\n\t\t\t\tvar prices = pm.getPrices();\r\n\t\t\t\tif(!prices) {\r\n\t\t\t\t\tprices = new RestBeans[\"PriceListRestBean\"]();\r\n\t\t\t\t\tpm.setPrices(prices);\r\n\t\t\t\t}\r\n\t\t\t\tthis.priceItems = prices.getItems();\r\n\t\t\t\tif(!this.priceItems) {\r\n\t\t\t\t\tthis.priceItems = new Collection();\r\n\t\t\t\t\tprices.setItems(this.priceItems);\r\n\t\t\t\t}\r\n\t\t\t\tthis.priceItems.each(function(price){\r\n\t\t\t\t\tthis.renderPrice(price);\r\n\t\t\t\t}, this);\r\n\t\t\t},\r\n\t\t\trenderPrice: function(price) {\r\n\t\t\t\tvar viewType;\r\n\t\t\t\tif(price instanceof RestBeans[\"SimplePriceRestBean\"]) {\r\n\t\t\t\t\tviewType = SimplePriceView;\r\n\t\t\t\t} else if(price instanceof RestBeans[\"StaggeredPriceRestBean\"]) {\r\n\t\t\t\t\tviewType = StaggeredPriceView;\r\n\t\t\t\t} else if(price instanceof RestBeans[\"ParameterizedPriceRestBean\"]) {\r\n\t\t\t\t\tconsole.log(\"rendering parameterized price\");\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tif(viewType) {\r\n\t\t\t\t\tvar view = new viewType({\r\n\t\t\t\t\t\tprice: price,\r\n\t\t\t\t\t\ttaxModels: this.taxModels,\r\n\t\t\t\t\t\tcurrencies: this.currencies,\r\n\t\t\t\t\t\tlisteners: {\r\n\t\t\t\t\t\t\tremoved: {\r\n\t\t\t\t\t\t\t\tfn: this.priceRemoved,\r\n\t\t\t\t\t\t\t\tscope: this\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\tthis.form.items.add(view);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tpriceRemoved: function(priceView) {\r\n\t\t\t\tvar price = priceView.price;\r\n\t\t\t\tthis.priceItems.remove(price);\r\n\t\t\t\tthis.form.items.remove(priceView);\r\n\t\t\t}\r\n});\r\nreturn PriceModelView;","initMethod@STRING":"","proxy@STRING":"","moduleId@STRING":""}}